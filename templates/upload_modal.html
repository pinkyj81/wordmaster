<!-- ✅ 텍스트 & 단어 업로드 모달 -->
<div id="uploadModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
  <div class="bg-white rounded-2xl shadow-xl w-[800px] p-8">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-2xl font-bold text-gray-800">텍스트 및 단어 업로드</h2>
      <button onclick="closeUploadModal()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
    </div>
    <p class="text-gray-500 mb-6">텍스트를 직접 입력하거나 엑셀 파일로 단어를 업로드하세요</p>

    <!-- ✅ 탭 메뉴 -->
    <div class="border-b mb-6">
      <nav class="flex space-x-8">
        <button id="tabText" onclick="switchTab('text')" class="pb-2 border-b-2 border-blue-600 text-blue-600 font-semibold">텍스트 업로드</button>
        <button id="tabExcel" onclick="switchTab('excel')" class="pb-2 text-gray-500 hover:text-blue-600">엑셀 업로드</button>
      </nav>
    </div>

    <!-- ✅ 텍스트 업로드 -->
    <div id="textUploadTab">
      <label class="block text-sm font-semibold text-gray-700 mb-1">제목</label>
      <input id="uploadTitle" class="w-full border rounded-lg p-2 mb-4" placeholder="텍스트 제목을 입력하세요">

      <label class="block text-sm font-semibold text-gray-700 mb-1">출처 (선택사항)</label>
      <input id="uploadSource" class="w-full border rounded-lg p-2 mb-4" placeholder="예: BBC News, The Guardian, 교과서 등">

      <label class="block text-sm font-semibold text-gray-700 mb-1">텍스트 내용 *</label>
      <textarea id="uploadContent" rows="8" class="w-full border rounded-lg p-3" placeholder="영어 텍스트를 입력하거나 붙여넣기 하세요..."></textarea>

      <div class="flex justify-end mt-6 space-x-3">
        <button onclick="closeUploadModal()" class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">취소</button>
        <button onclick="submitTextUpload()" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">저장</button>
      </div>
    </div>

    <!-- ✅ 엑셀 업로드 -->
    <div id="excelUploadTab" class="hidden">
      <label class="block text-sm font-semibold text-gray-700 mb-2">엑셀 파일 선택 (.xlsx)</label>
      <input type="file" id="excelFile" accept=".xlsx" class="mb-6">

      <p class="text-sm text-gray-500 mb-6">첫 번째 열: 단어 / 두 번째 열: 뜻 으로 구성된 엑셀 파일을 업로드하세요.</p>

      <div class="flex justify-end space-x-3">
        <button onclick="closeUploadModal()" class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">취소</button>
        <button onclick="submitExcelUpload()" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">업로드</button>
      </div>
    </div>
  </div>
</div>

<script>
// ✅ 탭 전환
function switchTab(tab) {
  const textTab = document.getElementById('textUploadTab');
  const excelTab = document.getElementById('excelUploadTab');
  const btnText = document.getElementById('tabText');
  const btnExcel = document.getElementById('tabExcel');

  if (tab === 'text') {
    textTab.classList.remove('hidden');
    excelTab.classList.add('hidden');
    btnText.classList.add('text-blue-600', 'border-b-2', 'border-blue-600');
    btnExcel.classList.remove('text-blue-600', 'border-b-2', 'border-blue-600');
  } else {
    textTab.classList.add('hidden');
    excelTab.classList.remove('hidden');
    btnExcel.classList.add('text-blue-600', 'border-b-2', 'border-blue-600');
    btnText.classList.remove('text-blue-600', 'border-b-2', 'border-blue-600');
  }
}

// ✅ 모달 열기 / 닫기
function openUploadModal() {
  const modal = document.getElementById('uploadModal');
  modal.classList.remove('hidden');
  modal.classList.add('flex');
}
function closeUploadModal() {
  const modal = document.getElementById('uploadModal');
  modal.classList.add('hidden');
}

// ✅ 텍스트 업로드
function submitTextUpload() {
  const title = document.getElementById('uploadTitle').value.trim();
  const source = document.getElementById('uploadSource').value.trim();
  const content = document.getElementById('uploadContent').value.trim();

  if (!content) return alert('텍스트 내용을 입력해주세요.');

  fetch('/upload_text', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ title, source, content })
  })
  .then(res => res.json())
  .then(data => {
    alert('✅ 텍스트 업로드 완료');
    closeUploadModal();
    location.reload();
  })
  .catch(() => alert('❌ 업로드 중 오류가 발생했습니다.'));
}

// ✅ 엑셀 업로드
function submitExcelUpload() {
  const file = document.getElementById('excelFile').files[0];
  if (!file) return alert('엑셀 파일을 선택해주세요.');

  const formData = new FormData();
  formData.append('file', file);

  fetch('/upload_excel', {
    method: 'POST',
    body: formData
  })
  .then(res => res.json())
  .then(data => {
    alert('✅ 엑셀 업로드 완료');
    closeUploadModal();
  })
  .catch(() => alert('❌ 엑셀 업로드 중 오류 발생'));
}
</script>
