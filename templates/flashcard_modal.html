{% extends "base.html" %}
{% block content %}

<h2 class="text-2xl font-semibold mb-6 text-gray-800 text-center">ì•”ê¸°ì¹´ë“œ</h2>

<!-- âœ… ì•”ê¸°ì¹´ë“œ íŒì—… -->
<div id="flashcardModal"
     class="fixed inset-0 bg-black/60 flex items-center justify-center z-50 backdrop-blur-sm">
  
  <!-- ì¹´ë“œ -->
  <div id="flashcard"
       class="text-white rounded-3xl shadow-2xl w-[90%] max-w-3xl h-[60vh]
              flex flex-col justify-center items-center transition-all duration-500 cursor-pointer select-none relative bg-gradient-to-br from-indigo-500 to-purple-500"
       onclick="flipCard()">

    <!-- ì§„í–‰ë„ -->
    <div class="absolute top-4 right-6 text-sm opacity-80">
      <span id="progressCount">1 / 1</span>
    </div>

    <!-- ì•ë©´ -->
    <div id="front" class="text-center transition-all duration-300 ease-in-out">
      <p id="word" class="text-5xl font-bold tracking-tight"></p>
      <p class="mt-8 text-sm opacity-70">(í´ë¦­í•˜ì—¬ ëœ» ë³´ê¸°)</p>
    </div>

    <!-- âœ… ë’·ë©´ -->
    <div id="back"
         class="hidden text-center transition-all duration-300 ease-in-out 
                bg-gradient-to-br from-[#5C6BF6] to-[#7D84FF]
                w-full h-full rounded-3xl flex flex-col justify-center items-center">
      <p id="wordBack" class="text-5xl font-bold tracking-tight mb-4 text-white"></p>
      <p id="meaning" class="text-2xl font-medium text-white/90"></p>

      <!-- âœ… ë°œìŒ ë“£ê¸° ë²„íŠ¼ (ì´ë²¤íŠ¸ ë²„ë¸”ë§ ë°©ì§€ í¬í•¨) -->
      <button
        onclick="playSound(event, document.getElementById('wordBack').innerText)"
        class="mt-6 bg-white text-indigo-600 px-4 py-2 rounded-full shadow hover:bg-indigo-100 flex items-center space-x-2">
        <span>ğŸ”Š</span>
        <span>ë°œìŒ ë“£ê¸°</span>
      </button>
      <audio id="audio"></audio>

      <p class="mt-8 text-sm opacity-80">(í´ë¦­í•˜ì—¬ ë‹¤ìŒ ë‹¨ì–´ë¡œ)</p>
    </div>
  </div>

  <!-- í•˜ë‹¨ ë²„íŠ¼ -->
  <div class="absolute bottom-10 w-full flex justify-center space-x-4">
    <button onclick="prevCard()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300">â—€ ì´ì „</button>
    <button onclick="nextCard()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300">ë‹¤ìŒ â–¶</button>
    <button onclick="closeFlashcardModal()" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">ë‹«ê¸°</button>
  </div>
</div>

<script>
function playSound(event, word) {
  // ì¹´ë“œ í´ë¦­ ì´ë²¤íŠ¸ê°€ ë¶€ëª¨ë¡œ ì „ë‹¬ë˜ì§€ ì•Šê²Œ ë§‰ê¸°
  event.stopPropagation();

  const audio = document.getElementById('audio');
  audio.src = `/tts/${encodeURIComponent(word)}?t=${Date.now()}`; // ìºì‹œ ë°©ì§€
  audio.play();
}

let currentIndex = 0;
let isFront = true;
const cards = {{ words | tojson }};

function openFlashcardModal() {
  document.getElementById("flashcardModal").classList.remove("hidden");
  currentIndex = 0;
  isFront = true;
  showCard();
}

function closeFlashcardModal() {
  // ëª¨ë‹¬ ë‹«ê¸° + í…ìŠ¤íŠ¸ ëª©ë¡ìœ¼ë¡œ ì´ë™
  window.location.href = "/";
}

function flipCard() {
  const front = document.getElementById("front");
  const back = document.getElementById("back");
  const flashcard = document.getElementById("flashcard");

  if (isFront) {
    // ì•ë©´ â†’ ë’·ë©´
    front.classList.add("hidden");
    back.classList.remove("hidden");
    flashcard.classList.remove("from-indigo-500", "to-purple-500");
    flashcard.classList.add("from-[#5C6BF6]", "to-[#7D84FF]");
    isFront = false;
  } else {
    // ë’·ë©´ â†’ ë‹¤ìŒ ì¹´ë“œë¡œ
    nextCard();
  }
}

function showCard() {
  const card = cards[currentIndex];
  document.getElementById("word").innerText = card.word;
  document.getElementById("wordBack").innerText = card.word;
  document.getElementById("meaning").innerText = card.meaning;
  document.getElementById("progressCount").innerText = `${currentIndex + 1} / ${cards.length}`;

  // ì´ˆê¸°í™” (ì•ë©´ìœ¼ë¡œ)
  const front = document.getElementById("front");
  const back = document.getElementById("back");
  const flashcard = document.getElementById("flashcard");
  front.classList.remove("hidden");
  back.classList.add("hidden");
  flashcard.classList.remove("from-[#5C6BF6]", "to-[#7D84FF]");
  flashcard.classList.add("from-indigo-500", "to-purple-500");
  isFront = true;
}

function nextCard() {
  if (currentIndex < cards.length - 1) {
    currentIndex++;
    showCard();
  } else {
    alert("ëª¨ë“  ì¹´ë“œë¥¼ ë‹¤ ë´¤ìŠµë‹ˆë‹¤!");
    window.location.href = "/";
  }
}

function prevCard() {
  if (currentIndex > 0) {
    currentIndex--;
  }
  showCard();
}

window.addEventListener('load', openFlashcardModal);
</script>

{% endblock %}
