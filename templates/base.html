<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Word Master</title>

  <!-- ✅ TailwindCSS & Font -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet" />
  <style>
    body { font-family: 'Noto Sans KR', sans-serif; }
  </style>
</head>

<body class="bg-gray-50 text-gray-800 min-h-screen flex flex-col">

  <!-- 🔹 상단 네비게이션 -->
  <nav class="bg-blue-600 text-white px-6 py-3 flex items-center justify-between shadow-md">
    <div class="flex items-center space-x-3">
      <span class="text-2xl">📘</span>
      <a href="/" class="font-bold text-lg hover:text-blue-200">Word Master</a>
    </div>

    <div class="flex space-x-6 text-sm font-medium">
      <a href="/" class="hover:underline">텍스트 목록</a>
      <a href="/texts" class="hover:underline">텍스트 관리</a>
      <a href="/learning_log" class="hover:underline">학습 기록</a>
      <button onclick="openUploadModal()" class="hover:underline">텍스트 업로드</button>
    </div>
  </nav>

  <!-- 🔹 본문 -->
  <main class="flex-1 p-6">
    {% block content %}{% endblock %}
  </main>

  <!-- 🔹 푸터 -->
  <footer class="text-center text-gray-500 text-sm py-4 border-t">
    © 2025 Word Master | Designed by Yujin
  </footer>

  <!-- 🔹 텍스트 & 단어 업로드 모달 -->
  <div id="uploadModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-2xl shadow-xl w-[800px] p-8 relative">
      <!-- 헤더 -->
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-2xl font-bold text-gray-800">텍스트 및 단어 업로드</h2>
        <button onclick="closeUploadModal()" class="text-gray-400 hover:text-gray-600 text-2xl absolute top-4 right-6">&times;</button>
      </div>
      <p class="text-gray-500 mb-6">텍스트를 직접 입력하거나 단어를 추가해보세요</p>

      <!-- ✅ 탭 메뉴 -->
      <div class="border-b mb-6">
        <nav class="flex space-x-8">
          <button id="tabText" onclick="switchTab('text')" class="pb-2 border-b-2 border-blue-600 text-blue-600 font-semibold">텍스트 업로드</button>
          <button id="tabWord" onclick="switchTab('word')" class="pb-2 text-gray-500 hover:text-blue-600">단어 업로드</button>
        </nav>
      </div>

      <!-- ✅ 텍스트 업로드 탭 -->
      <div id="textUploadTab">
        <label class="block text-sm font-semibold text-gray-700 mb-1">제목</label>
        <input id="uploadTitle" class="w-full border rounded-lg p-2 mb-4" placeholder="텍스트 제목을 입력하세요">

        <label class="block text-sm font-semibold text-gray-700 mb-1">출처 (선택사항)</label>
        <input id="uploadSource" class="w-full border rounded-lg p-2 mb-4" placeholder="예: BBC News, 교과서 등">

        <label class="block text-sm font-semibold text-gray-700 mb-1">텍스트 내용 *</label>
        <textarea id="uploadContent" rows="8" class="w-full border rounded-lg p-3 mb-6" placeholder="영어 텍스트를 입력하거나 붙여넣기 하세요..."></textarea>

        <div class="flex justify-end space-x-3">
          <button onclick="closeUploadModal()" class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">취소</button>
          <button onclick="submitTextUpload()" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">저장</button>
        </div>
      </div>

      <!-- ✅ 단어 업로드 탭 -->
<div id="wordUploadTab" class="hidden">
  <label class="block text-sm font-semibold text-gray-700 mb-1">텍스트 선택</label>
  <select id="wordTextSelect" class="w-full border rounded-lg p-2 mb-4">
    <option value="">텍스트를 선택하세요</option>
    {% for t in texts %}
    <option value="{{ t.id }}">{{ t.title }}</option>
    {% endfor %}
  </select>

  <label class="block text-sm font-semibold text-gray-700 mb-1">단어 목록 (한 줄당 하나씩)</label>
  <textarea id="bulkWordInput" rows="8" class="w-full border rounded-lg p-3 mb-6"
    placeholder="예시:&#10;glyph	상형문자&#10;haphazard	계획성이 없는&#10;hereditary	유전의"></textarea>

  <div class="flex justify-end space-x-2">
    <button onclick="closeUploadModal()" class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">취소</button>
    <button onclick="submitBulkWords()" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">저장</button>
  </div>
</div>

      </div>
    </div>
  </div>

  <!-- 🔹 스크립트 -->
  <script>
    // ✅ 탭 전환
    function switchTab(tab) {
      const textTab = document.getElementById('textUploadTab');
      const wordTab = document.getElementById('wordUploadTab');
      const btnText = document.getElementById('tabText');
      const btnWord = document.getElementById('tabWord');

      if (tab === 'text') {
        textTab.classList.remove('hidden');
        wordTab.classList.add('hidden');
        btnText.classList.add('text-blue-600', 'border-b-2', 'border-blue-600');
        btnWord.classList.remove('text-blue-600', 'border-b-2', 'border-blue-600');
      } else {
        textTab.classList.add('hidden');
        wordTab.classList.remove('hidden');
        btnWord.classList.add('text-blue-600', 'border-b-2', 'border-blue-600');
        btnText.classList.remove('text-blue-600', 'border-b-2', 'border-blue-600');
      }
    }

    // ✅ 모달 열기 / 닫기
    function openUploadModal() {
      const modal = document.getElementById('uploadModal');
      modal.classList.remove('hidden');
      modal.classList.add('flex');
    }
    function closeUploadModal() {
      const modal = document.getElementById('uploadModal');
      modal.classList.add('hidden');
    }

    // ✅ 단어 줄 추가
    function addWordRow() {
      const container = document.getElementById('wordInputs');
      const div = document.createElement('div');
      div.className = "flex items-center space-x-2";
      div.innerHTML = `
        <input class="word-input border rounded p-2 flex-1" placeholder="단어 입력">
        <input class="meaning-input border rounded p-2 flex-1" placeholder="뜻 입력">
      `;
      container.appendChild(div);
    }

    // ✅ 텍스트 업로드
    function submitTextUpload() {
      const title = document.getElementById('uploadTitle').value.trim();
      const source = document.getElementById('uploadSource').value.trim();
      const content = document.getElementById('uploadContent').value.trim();
      if (!title || !content) return alert('제목과 내용을 입력해주세요.');

      fetch('/upload_text', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ title, source, content })
      })
      .then(res => res.json())
      .then(() => {
        alert('✅ 텍스트 업로드 완료');
        closeUploadModal();
        location.reload();
      })
      .catch(() => alert('❌ 업로드 중 오류 발생'));
    }

    // ✅ 단어 업로드
    function submitWordUpload() {
      const textId = document.getElementById('wordTextSelect').value;
      if (!textId) return alert('텍스트를 선택하세요.');

      const words = Array.from(document.querySelectorAll('.word-input')).map((w, i) => ({
        word: w.value.trim(),
        meaning: document.querySelectorAll('.meaning-input')[i].value.trim()
      })).filter(w => w.word && w.meaning);

      if (words.length === 0) return alert('단어와 뜻을 입력해주세요.');

      fetch('/upload_words', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ text_id: textId, words })
      })
      .then(res => res.json())
      .then(() => {
        alert('✅ 단어 업로드 완료');
        closeUploadModal();
        location.reload();
      })
      .catch(() => alert('❌ 단어 업로드 중 오류 발생'));
    }
  </script>
</body>
</html>
