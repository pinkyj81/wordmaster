<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Word Master</title>

  <!-- âœ… TailwindCSS & Font -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet" />
  <style>
    body { font-family: 'Noto Sans KR', sans-serif; }
  </style>
</head>

<body class="bg-gray-50 text-gray-800 min-h-screen flex flex-col">

  <!-- ğŸ”¹ ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
  <nav class="bg-gradient-to-r from-purple-600 via-purple-500 to-indigo-600 text-white px-6 py-3 flex items-center justify-between shadow-md">
    <div class="flex items-center space-x-3">
      <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Logo" class="w-8 h-8 rounded-full">
      <a href="/" class="font-bold text-lg hover:text-purple-200">Word Master</a>
    </div>

    <div class="flex space-x-6 text-sm font-medium">
      <a href="/" class="hover:underline">í…ìŠ¤íŠ¸ ëª©ë¡</a>
      <a href="/learning_log" class="hover:underline">í•™ìŠµ ê¸°ë¡</a>
      <a href="/word_management" class="hover:underline">ë‹¨ì–´ ê´€ë¦¬</a>
      <button onclick="openUploadModal()" class="hover:underline">í…ìŠ¤íŠ¸ ì—…ë¡œë“œ</button>
      <a href="/exam_questions" class="hover:underline">ë¬¸ì œ í’€ê¸°</a>
      <a href="https://study-plan-6z8q.onrender.com/" target="_blank" class="hover:underline">ìì£¼ë…ë¦½</a>
      <a href="#" onclick="openUserManager()" class="hover:underline">ì‚¬ìš©ì ê´€ë¦¬</a>
      <a href="/logout" class="hover:underline">ë¡œê·¸ì•„ì›ƒ</a>
    </div>
  </nav>

  <!-- ğŸ”¹ ë³¸ë¬¸ -->
  <main class="flex-1 p-6">
    {% block content %}{% endblock %}
  </main>

  <!-- ğŸ”¹ í‘¸í„° -->
  <footer class="text-center text-gray-500 text-sm py-4 border-t">
    Â© 2025 Word Master | Designed by Yujin
  </footer>

  <!-- ğŸ”¹ í…ìŠ¤íŠ¸ & ë‹¨ì–´ ì—…ë¡œë“œ ëª¨ë‹¬ -->
  <div id="uploadModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-2xl shadow-xl w-[800px] p-8 relative">
      <!-- í—¤ë” -->
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-2xl font-bold text-gray-800">í…ìŠ¤íŠ¸ ë° ë‹¨ì–´ ì—…ë¡œë“œ</h2>
        <button onclick="closeUploadModal()" class="text-gray-400 hover:text-gray-600 text-2xl absolute top-4 right-6">&times;</button>
      </div>
      <p class="text-gray-500 mb-6">í…ìŠ¤íŠ¸ë¥¼ ì§ì ‘ ì…ë ¥í•˜ê±°ë‚˜ ë‹¨ì–´ë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”</p>

      <!-- âœ… íƒ­ ë©”ë‰´ -->
      <div class="border-b mb-6">
        <nav class="flex space-x-8">
          <button id="tabText" onclick="switchTab('text')" class="pb-2 border-b-2 border-blue-600 text-blue-600 font-semibold">í…ìŠ¤íŠ¸ ì—…ë¡œë“œ</button>
          <button id="tabWord" onclick="switchTab('word')" class="pb-2 text-gray-500 hover:text-blue-600">ë‹¨ì–´ ì—…ë¡œë“œ</button>
        </nav>
      </div>

      <!-- âœ… í…ìŠ¤íŠ¸ ì—…ë¡œë“œ íƒ­ -->
      <div id="textUploadTab">
        <label class="block text-sm font-semibold text-gray-700 mb-1">ì œëª©</label>
        <input id="uploadTitle" class="w-full border rounded-lg p-2 mb-4" placeholder="í…ìŠ¤íŠ¸ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">

        <label class="block text-sm font-semibold text-gray-700 mb-1">ì¶œì²˜ (ì„ íƒì‚¬í•­)</label>
        <input id="uploadSource" class="w-full border rounded-lg p-2 mb-4" placeholder="ì˜ˆ: BBC News, êµê³¼ì„œ ë“±">

        <label class="block text-sm font-semibold text-gray-700 mb-1">í…ìŠ¤íŠ¸ ë‚´ìš© *</label>
        <textarea id="uploadContent" rows="8" class="w-full border rounded-lg p-3 mb-6" placeholder="ì˜ì–´ í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ê±°ë‚˜ ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”..."></textarea>

        <div class="flex justify-end space-x-3">
          <button onclick="closeUploadModal()" class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">ì·¨ì†Œ</button>
          <button onclick="submitTextUpload()" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">ì €ì¥</button>
        </div>
      </div>

      <!-- âœ… ë‹¨ì–´ ì—…ë¡œë“œ íƒ­ -->
<div id="wordUploadTab" class="hidden">
  <label class="block text-sm font-semibold text-gray-700 mb-1">í…ìŠ¤íŠ¸ ì„ íƒ</label>
  <select id="wordTextSelect" class="w-full border rounded-lg p-2 mb-4">
    <option value="">í…ìŠ¤íŠ¸ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
  </select>

  <label class="block text-sm font-semibold text-gray-700 mb-1">ë‹¨ì–´ ëª©ë¡ (í•œ ì¤„ë‹¹ í•˜ë‚˜ì”©)</label>
  <textarea id="bulkWordInput" rows="8" class="w-full border rounded-lg p-3 mb-6"
    placeholder="ì˜ˆì‹œ:&#10;glyph	ìƒí˜•ë¬¸ì&#10;haphazard	ê³„íšì„±ì´ ì—†ëŠ”&#10;hereditary	ìœ ì „ì˜"></textarea>

  <div class="flex justify-end space-x-2">
    <button onclick="closeUploadModal()" class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">ì·¨ì†Œ</button>
    <button onclick="submitBulkWords()" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">ì €ì¥</button>
  </div>
</div>

      </div>
    </div>
  </div>

  <!-- ğŸ”¹ ìŠ¤í¬ë¦½íŠ¸ -->
  <script>
    // âœ… íƒ­ ì „í™˜
    function switchTab(tab) {
      const textTab = document.getElementById('textUploadTab');
      const wordTab = document.getElementById('wordUploadTab');
      const btnText = document.getElementById('tabText');
      const btnWord = document.getElementById('tabWord');

      if (tab === 'text') {
        textTab.classList.remove('hidden');
        wordTab.classList.add('hidden');
        btnText.classList.add('text-blue-600', 'border-b-2', 'border-blue-600');
        btnWord.classList.remove('text-blue-600', 'border-b-2', 'border-blue-600');
      } else {
        textTab.classList.add('hidden');
        wordTab.classList.remove('hidden');
        btnWord.classList.add('text-blue-600', 'border-b-2', 'border-blue-600');
        btnText.classList.remove('text-blue-600', 'border-b-2', 'border-blue-600');
        // ë‹¨ì–´ íƒ­ìœ¼ë¡œ ì „í™˜ì‹œ í…ìŠ¤íŠ¸ ëª©ë¡ ë¡œë“œ
        loadTextOptionsForBaseModal();
      }
    }

    // âœ… ëª¨ë‹¬ ì—´ê¸° / ë‹«ê¸°
    function openUploadModal() {
      const modal = document.getElementById('uploadModal');
      modal.classList.remove('hidden');
      modal.classList.add('flex');
    }
    function closeUploadModal() {
      const modal = document.getElementById('uploadModal');
      modal.classList.add('hidden');
    }

    // âœ… í…ìŠ¤íŠ¸ ëª©ë¡ ë¡œë“œ (base.htmlìš©)
    function loadTextOptionsForBaseModal() {
      const select = document.getElementById('wordTextSelect');
      select.innerHTML = '<option value="">í…ìŠ¤íŠ¸ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';
      
      fetch('/get_text_titles')
        .then(res => res.json())
        .then(texts => {
          if (texts.length === 0) {
            const option = document.createElement('option');
            option.value = '';
            option.textContent = 'ë“±ë¡ëœ í…ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤';
            option.disabled = true;
            select.appendChild(option);
            return;
          }
          
          texts.forEach(text => {
            const option = document.createElement('option');
            option.value = text.id;
            // ì¶œì²˜ ì •ë³´ë„ í•¨ê»˜ í‘œì‹œ
            option.textContent = text.source ? `[${text.source}] ${text.title}` : text.title;
            select.appendChild(option);
          });
        })
        .catch(err => {
          console.error('í…ìŠ¤íŠ¸ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', err);
        });
    }

    // âœ… í…ìŠ¤íŠ¸ ì—…ë¡œë“œ
    function submitTextUpload() {
      const title = document.getElementById('uploadTitle').value.trim();
      const source = document.getElementById('uploadSource').value.trim();
      const content = document.getElementById('uploadContent').value.trim();
      if (!title || !content) return alert('ì œëª©ê³¼ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');

      fetch('/upload_text', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ title, source, content })
      })
      .then(res => res.json())
      .then(() => {
        alert('âœ… í…ìŠ¤íŠ¸ ì—…ë¡œë“œ ì™„ë£Œ');
        closeUploadModal();
        location.reload();
      })
      .catch(() => alert('âŒ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ'));
    }

    // âœ… ë‹¨ì–´ ì¼ê´„ ì—…ë¡œë“œ
    function submitBulkWords() {
      const textId = document.getElementById('wordTextSelect').value;
      const rawList = document.getElementById('bulkWordInput').value.trim();

      if (!textId) return alert('í…ìŠ¤íŠ¸ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
      if (!rawList) return alert('ë‹¨ì–´ ëª©ë¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');

      // ë‹¨ì–´ ëª©ë¡ íŒŒì‹± (íƒ­ ë˜ëŠ” ê³µë°±ìœ¼ë¡œ êµ¬ë¶„)
      const words = rawList.split('\n').map(line => {
        const parts = line.trim().split(/\t+/);
        if (parts.length >= 2) {
          return { word: parts[0].trim(), meaning: parts.slice(1).join(' ').trim() };
        }
        // íƒ­ì´ ì—†ìœ¼ë©´ ê³µë°±ìœ¼ë¡œ ì‹œë„
        const [word, ...rest] = line.trim().split(/\s+/);
        return word && rest.length ? { word, meaning: rest.join(' ') } : null;
      }).filter(Boolean);

      if (words.length === 0) return alert('ì˜¬ë°”ë¥¸ í˜•ì‹ìœ¼ë¡œ ë‹¨ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');

      fetch('/upload_words', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ text_id: textId, words })
      })
      .then(res => res.json())
      .then(() => {
        alert('âœ… ë‹¨ì–´ ì—…ë¡œë“œ ì™„ë£Œ');
        closeUploadModal();
        location.reload();
      })
      .catch(() => alert('âŒ ë‹¨ì–´ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ'));
    }
  </script>
  <!-- âœ… Bootstrap JS (ëª¨ë‹¬ ë™ì‘ìš©) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
